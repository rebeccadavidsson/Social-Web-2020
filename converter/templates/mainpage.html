{% extends "base.html" %}

{% block title %} Homepage {% endblock %}

{% block nav %}{% include 'navigation.html' %}{% endblock nav %}

{% block body %}


<div class="mainschedule">
    <div id='calendar'></div>
 </div>

 <div id="mainfeed">

    <h4>This week</h4>
<hr>
    <!-- Message. Default to the left -->

      <div class="containerfeed darker">
        <img src="https://media-exp1.licdn.com/dms/image/C5603AQF54EcNtyGnyA/profile-displayphoto-shrink_200_200/0?e=1586995200&v=beta&t=TMMRXfh0RcT04rV6f8N-iJmTuxLo6Li5NU479VPgIVs" alt="Avatar" class="right">
        <!-- <h4>Eline followed:</h4> -->
        <h4>Spinning class</h4>
        <p>Evert van der Zee</p>
        <span class="time-left">Eline - Fr 21 Feb</span>
        <span class="time-right">
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star checked"></span>
          <span class="fa fa-star"></span>
        </span>
      </div>
    <br>
    <div class="containerfeed darker">
      <img src="https://i.vimeocdn.com/portrait/24338979_640x640" alt="Avatar" class="right">
      <!-- <h4>Eline followed:</h4> -->
      <h4>Boxing class</h4>
      <p>Ruud de Ligte</p>
      <span class="time-left">Annemijn - Sat 22 Feb</span>
      <span class="time-right">
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
      </span>
    </div>
    <br>

    <h4>WAY Back</h4>
    <hr>

    <div class="containerfeed darker">
      <img src="https://media-exp1.licdn.com/dms/image/C5603AQF54EcNtyGnyA/profile-displayphoto-shrink_200_200/0?e=1586995200&v=beta&t=TMMRXfh0RcT04rV6f8N-iJmTuxLo6Li5NU479VPgIVs" alt="Avatar" class="right">
      <!-- <h4>Eline followed:</h4> -->
      <h4>Spinning class</h4>
      <p>Monique Hoek</p>
      <span class="time-left">Eline - Wed 12 Feb</span>
      <span class="time-right">
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
      </span>
      <br>
        <hr>
        <p class="comments">  Stupid teacher!!! WAAH! </p>

    </div>


    <div class="total-feed">
      <div class="feed-message">
        Eline is wezen spinnen!!!! SUper goed!!
      </div>
      <span class="pull-right">Do 20 feb</span>

      <div class="feed-message">
        Eline je moet ook echt ClubVirtual lessen proberen,
        is ook mega leuk.
        Met een man genaamd Evert van de Zee en die is
        mega fan van zichzelf lol
      </div>
      <span class="pull-right">Wo 19 feb</span>

      <div class="feed-message">
        Dit is een foto van Evert naast zijn koelkast :) <br>
        <img src="https://www.run-waygirls.nl/wp-content/uploads/2015/06/Evert_van_der_Zee_39b.jpg" alt="">
      </div>
      <span class="pull-right">Wo 19 feb</span>

      <div class="feed-message">
        En kijk hier gaat hij er helemaal voor <br>
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcTpeL0edSLU2-UEiL2F1_lj4EZf78gSw-jtREo-zcgO0lJKRTht" alt="">
      </div>
      <span class="pull-right">Wo 19 feb</span>

      <div class="feed-message">
        En kijk hier gaat hij er helemaal voor <br>
        <img src="https://i.ytimg.com/vi/tpRE196Z8YQ/maxresdefault.jpg" alt="">
      </div>
      <span class="pull-right">Wo 19 feb</span>


    </div>
 </div>

 <script type="text/javascript">

    const input = document.getElementById("search-input");
    const searchBtn = document.getElementById("search-btn");
    const calendarEl = document.getElementById('calendar');
    
    function updateTimes(all_events, calendar1) {
      // this function adjusts the time range of the calendar based on the first and last event

      all_start_times = []
      all_start_times_int = []
      all_end_times = []
      all_end_times_int = []

      // for each event
      for(i = 0; i < all_events.length; i++) {

        // save start times
        time_string = all_events[i].start
        res = time_string.split("T")
        all_start_times.push(res[1])
        res2 = res[1].split(":")
        time = Number(res2[0]) + Number(res2[1]) * 0.01
        all_start_times_int.push(time)

        // save end times
        time_string = all_events[i].end
        res = time_string.split("T")
        all_end_times.push(res[1])
        res2 = res[1].split(":")
        time = Number(res2[0]) + Number(res2[1]) * 0.01
        all_end_times_int.push(time)
      }

      // adjust start time based on earliest event
      min = Math.min.apply(Math, all_start_times_int)

      // ensure the time always starts at full hour
      if (min % 1 > 0) {
        minTimeSplit = all_start_times[all_start_times_int.indexOf(min)].split(":")
        minTimeNew = minTimeSplit[0] + ":00:00"
        minTime = minTimeNew
      }
      else {
        minTime = all_start_times[all_start_times_int.indexOf(min)]
      }

      // set the start time
      calendar1.setOption('minTime', minTime)

      // adjust end time based on latest event
      max = Math.max.apply(Math, all_end_times_int)

      if (max - min < 8) {
        minTimeSmall = minTime.split(":")[0]
        new_max = Number(minTimeSmall) + 9
        maxTime  = new_max.toString() + ":00:00"
      }
      else {
        maxTime = all_end_times[all_end_times_int.indexOf(max)]
      }

      calendar1.setOption('maxTime', maxTime)
    }

    function addEvents(calendar, new_event, self) {
      // adds new events to the calendar. Set self = true if it is a course of the user, if it is a course of a friend set self = false
      
      // update the time range that is shown
      events_now = calendar.getOption('events')
      events_now.push(new_event)
      updateTimes(events_now, calendar)

      if (self == true) {
        new_event.color = 'green'
      }
      
      // add the new event
      calendar.addEvent(new_event)        
      events_now = calendar.getOption('events')
      
      // show updated calendar
      calendar.render()
    }

    const expand = () => {
      searchBtn.classList.toggle("close");
      input.classList.toggle("square");
    };

    if(searchBtn) {
      searchBtn.addEventListener("click", expand);
    }
    
    if(calendarEl) {
      var calendar1 = new FullCalendar.Calendar(calendarEl, {
        plugins: ['dayGrid', 'list', 'bootstrap', 'timeGrid'], 
                timeZone: 'UTC', 
                themeSystem: 'bootstrap',
                defaultView : 'timeGridWeek',
                header: {
                  left: 'prev, next today',
                  center: 'title', 
                  right: 'dayGridMonth, timeGridWeek, timeGridDay' // put this if we also want the day: 'dayGridDay'
                }, 
                weekNumbers: true,
                eventLimit: true,
                firstDay: 1,
                allDaySlot: false,
                // columnHeaderFormat: {
                //   // hour12 : false
                // },
                eventColor : 'purple',
                slotDuration : '00:20:00',
                // minTime: "07:00:00",
                // maxTime: "21:00:00",
                events: [
                  {
                    title  : 'Spinning',
                    start  : '2020-02-29T12:30:00',
                    end    : '2020-02-29T13:30:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                  },
                  {
                    title  : 'Yoga',
                    start  : '2020-02-29T10:30:00',
                    end    : '2020-02-29T11:30:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                    color : 'green'
                  },
                  {
                    title  : 'BBB',
                    start  : '2020-02-25T09:00:00',
                    end    : '2020-02-25T10:00:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                  },
                  {
                    title  : 'Total Body Workout',
                    start  : '2020-03-01T11:30:00',
                    end    : '2020-03-01T13:00:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                  },
                  {
                    title  : 'HIIT',
                    start  : '2020-02-27T09:00:00',
                    end    : '2020-02-27T10:00:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                  },
                  {
                    title  : 'Synergy',
                    start  : '2020-02-28T09:30:00',
                    end    : '2020-02-28T10:15:00',
                    allDay : false, // will make the time show
                    displayEventTime : true,
                    displayEventEnd : true, 
                    extendedProps: {
                      teacher: 'Leah Carlin', 
                      location: 'Universum'
                    },
                  }
                ],
                eventRender: function(event, calendar) { 
                  // add teacher
                  event.el.append(event.event.extendedProps.teacher)
                  // eventually add location:
                  // event.el.append("\n"+ event.event.extendedProps.location)
                }
        });
        events = calendar1.getOption('events')
        updateTimes(events, calendar1)
        calendar1.render();
      }
            

            


 </script>

{% endblock %}
