{% extends "base.html" %}

{% block title %} Profile {% endblock %}

{% block nav %}{% include 'navigation.html' %}{% endblock nav %}

{% block body %}

{% load static %}

<div class="space"></div>
<div class="container emp-profile">
    <form method="post" action="{% url 'settings' profile.pk %}">
      {% csrf_token %}
        <div class="row">
            <div class="col-md-4">
                <div class="profile-img">
                    <img src="{{ profile.photo.url }}" alt="Profile picture"/>
                </div>

            </div>
            <div class="col-md-8">
              <div class="search-bar">
                <input type="text" name="search" value="" autocomplete="off" id="myinput" onkeyup="searchFunction()" onkeydown="release()" placeholder="Search">
                  <ul id="wrapper">
                    <!-- SEARCH OPTIONS -->
                    {% for name in searchprofiles %}
                      <div id="friendoption" style="display:none;">
                        <a href="{% url 'searchprofile' name %}" style="color:white">{{ name.user.first_name }} {{ name.user.last_name }}</a>
                        <span class="time-right">
                          <button type="button" name="button" class="followbutton"><a href="{% url 'follow' name %}">Follow +</a></button>
                          <!-- <a href="{% url 'follow' username %}" class="btn btn-success">Follow +</a> -->
                        </span>
                        <span class="time-right"><img src="{{ name.photo.url }}" alt="Avatar" class="right"></span>
                      </div>
                      {% endfor %}
                  </ul>
              </div>
                <div class="profile-head">
                  <h4>{{ firstname }} {{ lastname }} - {{ username }}</h4>
                    <ul class="nav nav-tabs" id="myTab" role="tablist" style="width:97%;">
                      <br>
                    </ul>
                    <div class="friendsview">

                      <div class="row" id="friendsrow">
                        <!-- <div class="arrows">
                          <a class="arrow right" id="scrollfriends"></a>
                        </div> -->

                        {% for person in following_profiles %}
                        <div class="col-sm">
                          <div class="card">
                            <div class="cardbackground">
                              <div class="card-body">
                                <h5 class="card-title">{{ person.first.user.first_name }}</h5>
                                <p>{{ person.first.user.last_name }}</p>
                                <img src={{person.first.photo.url}} alt="">
                                <a href="{% url 'unfollow' person.first.user %}" class="btn btn-light">Unfollow +</a>
                              </div>
                            </div>
                          </div>
                        </div>


                        {% endfor %}



                        {% for person in profiles_to_follow %}
                        {% if person.user.username != "admin" %}
                        <div class="col-sm">
                          <div class="card">
                            <div class="cardbackground">
                              <div class="card-body">
                                <h5 class="card-title">{{ person.user.first_name }}</h5>
                                <p>{{ person.user.last_name }}</p>
                                <img src="{{person.photo.url}}" alt="">
                                <a href="{% url 'follow' person.user.username %}" class="btn btn-success">Follow +</a>
                              </div>
                            </div>
                          </div>
                        </div>
                        {% endif %}
                        {% endfor %}

                      </div>
                    </div>
                    <div class="space"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4" id="underimg_col">
              <br>
                <div class="profile-work">
                    <a href=""> {{ firstname }} {{ lastname }}</a><br/>
                    <p>Logged in as: {{ username }}</p>
                    <!-- {% if profile.interests %}
                    <p>Interests:<br>{{ profile.interests }}
                      {% endif %} -->

                </div>
                <input type="submit" class="profile-edit-btn" name="btnAddMore" value="Edit Profile"/>
                <br>
                <div class="space"></div>

            <div class="followers_for_this_person">
              <div class="row">
                  <div class="col">
                      <div class="leftcol">
                        <h3>Followers</h3>
                          {{ followers_for_this_person|length }}
                      </div>
                  </div>

                  <div class="col">
                      <div class="rightcol">
                        <h3>Following</h3>
                          {{ following_profiles|length }}
                      </div>
                  </div>
              </div>

              {% if followers_for_this_person %}
              <br>
              <h2>Your followers:</h2>
              {% for follower in followers_for_this_person %}
              <br>
              <hr>
              <span style="float:left;"><p>{{ follower.user.first_name }} {{ follower.user.last_name }}</p></span>
              <span><img src="{{follower.photo.url}}" alt=""></span>
              {% endfor %}


            {% endif %}
            </div>
            <div class="toprated">
              <div class="row">
                <div class="col">


              <br>
              <br>
              {% if ratings %}
                <h4>Your rated lessons</h4>
                <ul>


                {% for rating in ratings %}
                <br>
                <li>
                    <p>{{ rating.event.name }}</p>
                    {% for i in n %}
                      {% if rating.rating >= i %}
                        <span class="fa fa-star checked"></span>
                      {% else %}
                        <span class="fa fa-star"></span>
                      {% endif %}
                    {% endfor %}
                  </li>
                {% endfor %}
                      </ul>
              {% endif %}
            </div>  </div>
          </div>
            </div>
            <div class="col-md-8">
              <div class="card" id="history_personal">
                <div class="card-body">
                  {% if events_user %}
                  <h4 style="color:grey; font-weight:500;">Recent classes</h4>
                  {% else %}
                  <h4 style="color:grey; font-weight:500;">You haven't added any classes yet.</h4>
                  {% endif  %}
                  <br>
                  {% for event in events_user %}
                    <h2>
                      <span style="margin-left: 0px; font-size:18px;">{{ event.name }} -</span>
                      <span style="font-size:12px; color:##3d3d3d;">{{ event.teacher }}</span>
                      <span style="float: right; font-size:12px;">{{ event.date }}</span>
                    </h2>
                    <br>
                    <hr>
                  {% endfor %}

                </div>
              </div>

              <!-- <img src="https://www.pngkey.com/png/full/238-2383266_line-graph-png-transparent-line-graph-png.png" id="firstgraph" alt="">
              <img src="https://images.vexels.com/media/users/3/129159/isolated/preview/b6536fdfc4c89f86e1ecf2fa85f2ca95-2d-colorful-bar-chart-infographic-by-vexels.png" alt=""> -->
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">

  function searchFunction() {
    var input, filter, ul, li, a, i;
    input = document.getElementById('myinput');
    filter = input.value.toUpperCase();
    ul = document.getElementById('wrapper');
    li = ul.getElementsByTagName('div');

    for(i=0 ; i< li.length; i++){
        a = li[i].getElementsByTagName('a')[0];
        if(a.innerHTML.toUpperCase().indexOf(filter) > -1){
            li[i].style.display = "";
        }

        else{
            li[i].style.display = 'none';
        }
    }
}

function release() {
  // ul = document.getElementById('wrapper');
  // ul.style.display = "none"
}

document.getElementById('myinput').addEventListener('keydown', function (event) {
  if (event.keyCode == 8 || event.keyCode == 46 || event.keyCode == 27) {
    document.getElementById('wrapper').style.display = "none";
  }
  else {
    document.getElementById('wrapper').style.display = "";
  }
});

</script>

{% endblock %}
